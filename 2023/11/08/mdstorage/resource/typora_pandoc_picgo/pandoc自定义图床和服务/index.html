
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>pandoc自定义图床和服务.md | Xiaoy</title>
    <meta name="author" content="xiaoy" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>XIAOY</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;XIAOY</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>pandoc自定义图床和服务.md</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/11/8
        </span>
        
        <span class="category">
            <a href="/categories/resource/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                resource
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/typora/" style="color: #00bcd4">
                    typora
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h2 id="自定义图床服务"><a href="#自定义图床服务" class="headerlink" title="自定义图床服务"></a>自定义图床服务</h2><ul>
<li>环境要求<ul>
<li>linux</li>
<li>golang</li>
</ul>
</li>
<li>代码</li>
</ul>
<pre><code class="golang">package main

import (
    &quot;io&quot;
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;os&quot;
)

var (
    // 文件 key
    uploadFileKey = &quot;file&quot;
    // 上传的图片保存根路径
    filePath = &quot;/data/repo/picpicgo/&quot;
)


func main() &#123;
    http.HandleFunc(&quot;/&quot;, uploadHandler)
    if err := http.ListenAndServe(&quot;:12798&quot;, nil); err != nil &#123;
        log.Fatalf(&quot;error to start http server:%s&quot;, err.Error())
    &#125;
&#125;

func uploadHandler(w http.ResponseWriter, r *http.Request) &#123;
    // 接受文件
    file, header, err := r.FormFile(uploadFileKey)
    if err != nil &#123;
        // ignore the error handler
    &#125;
    log.Printf(&quot;selected file name is %s&quot;, header.Filename)
    authValue := r.Header.Get(&quot;Authorization&quot;)
    if (authValue != &quot;Basic eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoxLCJsb2NhbGUiOiJlbiIsInZpZXdNb2RlIjoibW9zYWljIiwic2luZ2xlQ2xpY2siOmZhbHNlLCJwZXJtIjp7ImFkbWluIjp0cnVlLCJleGVjdXRlIjp0cnVlLCJjcmVhdGUiOnRydWUsInJlbmFtZSI6dHJ1ZSwibW9kaWZ5Ijp0cnVlLCJkZWxldGUiOnRydWUsInNoYXJlIjp0cnVlLCJkb3dubG9hZCI6dHJ1ZX0sImNvbW1hbmRzIjpbXSwibG9ja1Bhc3N3b3JkIjpmYWxzZSwiaGlkZURvdGZpbGVzIjpmYWxzZSwiZGF0ZUZvcm1hdCI6ZmFsc2V9LCJpc3MiOiJGaWxlIEJyb3dzZXIiLCJleHAiOjE2OTkzNTUyNTMsImlhdCI6MTY5OTM0ODA1M30.xOF_H27bkI2qL0ozpDGWCJKOToegAzZjIk6edFWqZC0&quot;) &#123;
        log.Printf(&quot;auth fail&quot;)
        return
    &#125;
    path := filePath + r.Header.Get(&quot;Uri&quot;)
    createFile(path)
    imgPath := path + header.Filename
    log.Printf(&quot;path is %s&quot;, path)

    // 将文件拷贝到指定路径下，或者其他文件操作
    dst, err := os.Create(imgPath)
    if err != nil &#123;
        log.Fatalf(&quot;create file error :%s&quot;, err.Error())
        // ignore
    &#125;
    _, err = io.Copy(dst, file)
    if err != nil &#123;
        log.Fatalf(&quot;copy file error :%s&quot;, err.Error())
        // ignore
    &#125;
    log.Printf(&quot;upload success&quot;)
    io.WriteString(w, &quot;&#123;\&quot;code\&quot;: 0, \&quot;data\&quot;: &#123;\&quot;url\&quot;: \&quot;&quot; + (r.Header.Get(&quot;ImgHost&quot;) + r.Header.Get(&quot;Uri&quot;) + header.Filename ) + &quot;\&quot;&#125;&#125;&quot;)
&#125;


//调用os.MkdirAll递归创建文件夹
func createFile(filePath string)  error  &#123;
    if !isExist(filePath) &#123;
        err := os.MkdirAll(filePath,os.ModePerm)
        return err
    &#125;
    return nil
&#125;

// 判断所给路径文件/文件夹是否存在(返回true是存在)
func isExist(path string) bool &#123;
    _, err := os.Stat(path)    //os.Stat获取文件信息
    if err != nil &#123;
        if os.IsExist(err) &#123;
            return true
        &#125;
        return false
    &#125;
    return true
&#125;
</code></pre>
<pre><code class="systemd">[Unit]
Description=picgo-server

[Service]
ExecStart=/opt/picgo-server/picgo-server

[Install]
WantedBy=multi-user.target
</code></pre>
<h2 id="pandoc-自定义图床"><a href="#pandoc-自定义图床" class="headerlink" title="pandoc 自定义图床"></a>pandoc 自定义图床</h2><ul>
<li>web-uploader 1.1.1 下载安装<ul>
<li>插件设置 -&gt; 搜索下载即可</li>
</ul>
</li>
<li>web-uploader 配置<ul>
<li><a target="_blank" rel="noopener" href="https://mafgwo.cn/2021/01/16/2010_PicGo%E7%94%A8golang%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E5%BA%8A%E4%B8%8A%E4%BC%A0%E6%9C%8D%E5%8A%A1/">参考链接</a> </li>
<li>API 地址 ： <a target="_blank" rel="noopener" href="http://119.91.145.27:12798/">http://119.91.145.27:12798/</a></li>
<li>POST参数名 ： file</li>
<li>JSON路径 ： data.url （这个是上传接口返回值的 url 的值，对照上面代码就明白了）</li>
<li>自定义请求头 ： {“Authorization”:”Basic eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7ImlkIjoxLCJsb2NhbGUiOiJlbiIsInZpZXdNb2RlIjoibW9zYWljIiwic2luZ2xlQ2xpY2siOmZhbHNlLCJwZXJtIjp7ImFkbWluIjp0cnVlLCJleGVjdXRlIjp0cnVlLCJjcmVhdGUiOnRydWUsInJlbmFtZSI6dHJ1ZSwibW9kaWZ5Ijp0cnVlLCJkZWxldGUiOnRydWUsInNoYXJlIjp0cnVlLCJkb3dubG9hZCI6dHJ1ZX0sImNvbW1hbmRzIjpbXSwibG9ja1Bhc3N3b3JkIjpmYWxzZSwiaGlkZURvdGZpbGVzIjpmYWxzZSwiZGF0ZUZvcm1hdCI6ZmFsc2V9LCJpc3MiOiJGaWxlIEJyb3dzZXIiLCJleHAiOjE2OTkzNTUyNTMsImlhdCI6MTY5OTM0ODA1M30.xOF_H27bkI2qL0ozpDGWCJKOToegAzZjIk6edFWqZC0”, “uri”: “”, “imgHost”: “<a target="_blank" rel="noopener" href="http://119.91.145.27:12799/api/public/dl/p8KdAUHH/%22%7D">http://119.91.145.27:12799/api/public/dl/p8KdAUHH/&quot;}</a>    (对照上面代码就明白了)</li>
<li>自定义 Body ： 无</li>
</ul>
</li>
</ul>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2024 - 2024 Xiaoy
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;xiaoy
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
