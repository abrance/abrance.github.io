
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>端口规划文档.md | Xiaoy</title>
    <meta name="author" content="xiaoy" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>XIAOY</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;XIAOY</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>端口规划文档.md</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/9/4
        </span>
        
        
    </div>
    
    <div class="content" v-pre>
        <pre><code class="Text">端口规划文档

    &gt;&gt; 概述

        总控引擎的任务因为是在客户提供的环境下运行, 所以端口需要规划, 避免出现与客户部署的服务端口冲突的情况

        同时, 也需要告知客户有哪些端口需要放开, 避免防火墙

        每个端口只会分配一个固定的组件, 组件如果废弃掉, 端口再分配给另一个组件, 这样避免多个版本组件端口冲突的情况

        目前待规划的端口池 [22000-29000)

    &gt;&gt; 蓝图

        &gt;&gt;&gt; 总控

            总控和总控组件    [29000-29100)

            可视化和可视化组件  [29100-29200)

            全流量组件 [29200-29300] 

            API 组件  [29300-29400)

            第三方组件      [29900-30000)


        &gt;&gt;&gt; 引擎

            &gt;&gt;&gt;&gt; HA 组件

                管理面 HA 组件   [20100-20133)

                调度节点 HA 组件  [20133-20166)

            &gt;&gt;&gt;&gt; 引擎安装组件

                自研组件      [20000, 20100)

            &gt;&gt;&gt;&gt; 管理面组件

                自研组件      [20200-20300)

                第三方组件     [20300-20400)

            &gt;&gt;&gt;&gt; 调度节点组件

                自研组件      [28900-28950)

            &gt;&gt;&gt;&gt; 数据面组件

                自研组件      [28950-29000)

    &gt;&gt; 总控使用的端口

        &gt;&gt;&gt; 概述

            总控使用端口思路不用太严格, 因为总控是与引擎分开部署的, 理论上这台机器没有引擎运行

            总控除了80 443外使用 [29000-30000) (包括29000, 不包括 30000)

            sc 和 sc的组件使用 [29000-29100)

            sv 和 sv的组件使用 [29100-29200)

            全流量和全流量组件 [29200-29300)

            API 组件  [29300-29400)

            总控的第三方组件使用 [29900-30000)

        sc(80 443 8080)   -&gt; 29000

        installer(8098)   -&gt; 29001		

        meta(29010)   -&gt; 29010	

        sv(20522)      -&gt; 29100

        mongodb(27017)   -&gt; 29900

        redis(6379)     -&gt; 29901

        mysql(3306)     -&gt; 29902

        etcd(2379 2380)   -&gt; 29903 29904

        AgentServer(29201,29202)		    # 2024/4/7

    &gt;&gt; 引擎

        &gt;&gt;&gt; 概述

            引擎使用端口思路是必须要严格而且要整齐, 因为引擎要负责服务转发, 需要与客户共享端口资源

            引擎拆分后有 SE-M SE-S SE-W , 三个组件 都可以部署一台节点上, 也可以分开部署, 直接视为部署到一台节点的情况.

            引擎使用 [20000-29000) 的端口, 其中管理面使用 [20200-28900), 调度节点使用 [28900-28950), 数据面使用 [28950-29000), 这样安排的理由是, 管理面可能开较多的插件服务, 端口是为插件服务提供的.

            安装引擎的服务统一规划, 安装引擎目前不管是什么组件, 都是通过 agent 统一安装的, 所以 agent 端口都是 20000, 引擎安装使用 [20000, 20100)

            引擎HA在引擎端口下统一规划, 每个引擎节点不管是什么组件, 都有 nexus 服务, 端口都是 20100, nexus 属于 HA 相关组件, HA 相关的服务使用 [20100, 20200)

            

        &gt;&gt;&gt; 引擎组件和对应的端口

            &gt;&gt;&gt;&gt; SE-M 管理面组件

                &gt;&gt;&gt;&gt;&gt; 管理面节点安装的服务使用 [20000-20010) 端口, 管理面自研应用使用 [20200-20300), 管理面第三方组件 [20300-20400), 管理面插件应用使用 [21000-22000), 管理面 HA 组件 [20100-20133), admin_dam 和 data_dam 比较特殊, 其中端口做到了复用, admin_dam和data_dam共用了 28952 端口, 一个绑定 127.0.0.1, 一个绑定 VIP, 所以不会冲突

                

                agent(8099)      -&gt; 20000

                nexus(8000)				   -&gt; 20100				

                admin_ha(6898)     -&gt; 20101

                webserver(8299 8298)  -&gt; 20200 20201

                etcd(2379 2380)    -&gt; 20300 20301

                apiserver(6443)    -&gt; 20302

                全局限速(7676)     -&gt; 21000

                admin_dam($VIP:7000 8899 8443) -&gt; $VIP:28952 20202 20203

            &gt;&gt;&gt;&gt; SE-S 调度节点组件

                &gt;&gt;&gt;&gt;&gt; 调度节点 HA 使用 [20133-20166)

                

                agent(8099)      -&gt; 20000

                data_ha grpc(6899)   -&gt; 20133

* 				nexus(8000)      -&gt; 20100

            &gt;&gt;&gt;&gt; SE-W 数据面组件

                &gt;&gt;&gt;&gt;&gt; 数据面 HA使用 [20166-20199), 数据面自研应用使用 [28950-29000)

                agent(8099)			    -&gt; 20000

                nexus(8000)      -&gt; 20100				

                envoy(9902)      -&gt; 28950				

                data_dam(9977 127.0.0.1:7000)     -&gt; 28951 127.0.0.1:28952

                polycube(9000)     -&gt; 28953

                super_glue        28954    内部组件使用端口, envoy 相关

                dataWorker(6879)

                边车模式     -&gt; 28960-28965
</code></pre>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2024 - 2024 Xiaoy
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;xiaoy
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
