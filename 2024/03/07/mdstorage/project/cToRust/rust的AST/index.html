
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>rust的AST.md | Xiaoy</title>
    <meta name="author" content="xiaoy" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>XIAOY</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;XIAOY</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>rust的AST.md</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/3/7
        </span>
        
        <span class="category">
            <a href="/categories/project/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                project
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/Rust/" style="color: #ffa2c4">
                    Rust
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/AST/" style="color: #ff7d73">
                    AST
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="color: #00bcd4">
                    编译原理
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <p><a href="mailto:&#49;&#x31;&#48;&#x33;&#x30;&#x39;&#x38;&#x36;&#x30;&#x37;&#64;&#113;&#113;&#x2e;&#x63;&#111;&#x6d;">&#49;&#x31;&#48;&#x33;&#x30;&#x39;&#x38;&#x36;&#x30;&#x37;&#64;&#113;&#113;&#x2e;&#x63;&#111;&#x6d;</a></p>
<h2 id="Rust-输出-AST"><a href="#Rust-输出-AST" class="headerlink" title="Rust 输出 AST"></a>Rust 输出 AST</h2><h3 id="切换为-nightly-版本"><a href="#切换为-nightly-版本" class="headerlink" title="切换为 nightly 版本"></a>切换为 nightly 版本</h3><p><code>rustup override set nightly</code></p>
<p><code>rustc --version</code></p>
<h3 id="输出-AST"><a href="#输出-AST" class="headerlink" title="输出 AST"></a>输出 AST</h3><pre><code class="bash">rustc -Z help

# 简略
rustc +nightly src/main.rs -Z unpretty=ast-tree

# 详细
rustc +nightly src/main.rs -Z unpretty=ast-tree,expanded
</code></pre>
<h2 id="Rust-AST-分析"><a href="#Rust-AST-分析" class="headerlink" title="Rust AST 分析"></a>Rust AST 分析</h2><h2 id="Rust-AST-to-Rust-code"><a href="#Rust-AST-to-Rust-code" class="headerlink" title="Rust AST to Rust code"></a>Rust AST to Rust code</h2><h2 id="构建-Rust-程序"><a href="#构建-Rust-程序" class="headerlink" title="构建 Rust 程序"></a>构建 Rust 程序</h2><h3 id="syn-ItemFn"><a href="#syn-ItemFn" class="headerlink" title="syn::ItemFn"></a>syn::ItemFn</h3><pre><code class="rust">pub struct ItemFn &#123;
    pub attrs: Vec&lt;Attribute&gt;,
    pub vis: Visibility,
    pub sig: Signature,
    pub block: Box&lt;Block&gt;,
&#125;
</code></pre>
<p><code>ItemFn</code> 是 <code>syn</code> 库中用于表示 Rust 函数的结构体。它包含了构成一个函数定义的所有主要部分。以下是对 <code>ItemFn</code> 结构体各字段的详细解释：</p>
<h3 id="attrs-Vec"><a href="#attrs-Vec" class="headerlink" title="attrs: Vec&lt;Attribute&gt;"></a><code>attrs: Vec&lt;Attribute&gt;</code></h3><ul>
<li><code>attrs</code> 字段包含了函数上的属性（attributes）。在 Rust 中，属性用于给编译器传递额外的信息，比如 <code>#[derive(Debug)]</code> 或者 <code>#[test]</code>。这些属性可以应用于许多种类的项，包括函数、结构体、枚举等。</li>
<li>类型为 <code>Vec&lt;Attribute&gt;</code>，意味着一个函数可以有零个或多个属性。</li>
</ul>
<h3 id="vis-Visibility"><a href="#vis-Visibility" class="headerlink" title="vis: Visibility"></a><code>vis: Visibility</code></h3><ul>
<li><code>vis</code> 字段表示函数的可见性（visibility）。Rust 中的可见性关键字有 <code>pub</code>、<code>pub(crate)</code> 等，用于控制项（比如函数、结构体字段等）的访问范围。</li>
<li><code>Visibility</code> 是一个枚举，包含了不同的可见性级别，例如公开（<code>Public</code>）、私有（<code>Inherited</code>）、受限（具体受限的范围，如在模块内可见）等。</li>
</ul>
<h3 id="sig-Signature"><a href="#sig-Signature" class="headerlink" title="sig: Signature"></a><code>sig: Signature</code></h3><ul>
<li><code>sig</code> 字段包含了函数的签名。函数签名定义了函数的名称、参数、返回类型以及其他如是否 <code>async</code>、是否 <code>unsafe</code> 的信息。</li>
<li><code>Signature</code> 是一个结构体，包含了函数名称（<code>ident</code> 字段为 <code>Ident</code> 类型）、输入参数列表（<code>inputs</code> 字段为 <code>Punctuated&lt;FnArg, Comma&gt;</code> 类型）、返回类型（<code>output</code> 字段为 <code>ReturnType</code> 类型）、泛型参数等。</li>
</ul>
<h3 id="block-Box"><a href="#block-Box" class="headerlink" title="block: Box&lt;Block&gt;"></a><code>block: Box&lt;Block&gt;</code></h3><ul>
<li><code>block</code> 字段表示函数体，包含了函数的实际代码块。在 Rust 中，函数体由一系列的语句和可能的尾部表达式组成。</li>
<li>类型为 <code>Box&lt;Block&gt;</code>，这里 <code>Block</code> 是一个结构体，表示由花括号 <code>&#123;&#125;</code> 包围的代码块。<code>Box</code> 是 Rust 的一个智能指针类型，用于在堆上分配内存。这里使用 <code>Box</code> 是因为代码块可能包含大量的数据，使用堆分配可以避免栈溢出，并且可以提高数据结构的整体性能。</li>
</ul>
<h2 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h2><p><code>Signature</code> 结构体在 <code>syn</code> 库中代表了 Rust 函数的签名部分。以下是对 <code>Signature</code> 结构体各字段的详细解释：</p>
<h3 id="constness-Option"><a href="#constness-Option" class="headerlink" title="constness: Option&lt;Const&gt;"></a><code>constness: Option&lt;Const&gt;</code></h3><ul>
<li><code>constness</code> 字段表示函数是否是一个 <code>const</code> 函数。在 Rust 中，<code>const</code> 函数可以在编译时被求值。</li>
<li>类型为 <code>Option&lt;Const&gt;</code>，这意味着该字段可以是 <code>None</code>（表示函数不是 <code>const</code>）或 <code>Some(Const)</code>（表示函数是 <code>const</code>）。</li>
</ul>
<h3 id="asyncness-Option"><a href="#asyncness-Option" class="headerlink" title="asyncness: Option&lt;Async&gt;"></a><code>asyncness: Option&lt;Async&gt;</code></h3><ul>
<li><code>asyncness</code> 字段表示函数是否是异步的，即是否使用了 <code>async</code> 关键字。异步函数允许使用 <code>.await</code> 语法进行异步操作。</li>
<li>类型为 <code>Option&lt;Async&gt;</code>，这意味着该字段可以是 <code>None</code>（表示函数不是异步的）或 <code>Some(Async)</code>（表示函数是异步的）。</li>
</ul>
<h3 id="unsafety-Option"><a href="#unsafety-Option" class="headerlink" title="unsafety: Option&lt;Unsafe&gt;"></a><code>unsafety: Option&lt;Unsafe&gt;</code></h3><ul>
<li><code>unsafety</code> 字段表示函数是否是 <code>unsafe</code> 的。在 Rust 中，<code>unsafe</code> 函数允许执行一些正常情况下被 Rust 安全保证所禁止的操作，如直接操作裸指针。</li>
<li>类型为 <code>Option&lt;Unsafe&gt;</code>，这意味着该字段可以是 <code>None</code>（表示函数不是 <code>unsafe</code>）或 <code>Some(Unsafe)</code>（表示函数是 <code>unsafe</code> 的）。</li>
</ul>
<h3 id="abi-Option"><a href="#abi-Option" class="headerlink" title="abi: Option&lt;Abi&gt;"></a><code>abi: Option&lt;Abi&gt;</code></h3><ul>
<li><code>abi</code> 字段表示函数的应用二进制接口（Application Binary Interface，ABI）。ABI 定义了如何在不同的二进制模块或不同的编程语言之间调用函数。</li>
<li>类型为 <code>Option&lt;Abi&gt;</code>，这意味着该字段可以是 <code>None</code>（使用 Rust 默认的 ABI）或 <code>Some(Abi)</code>（使用特定的 ABI，如 <code>&quot;C&quot;</code>）。</li>
</ul>
<h3 id="fn-token-Fn"><a href="#fn-token-Fn" class="headerlink" title="fn_token: Fn"></a><code>fn_token: Fn</code></h3><ul>
<li><code>fn_token</code> 字段是 <code>Fn</code> 类型的 token，表示了 <code>fn</code> 关键字的存在。</li>
</ul>
<h3 id="ident-Ident"><a href="#ident-Ident" class="headerlink" title="ident: Ident"></a><code>ident: Ident</code></h3><ul>
<li><code>ident</code> 字段是 <code>Ident</code> 类型，代表函数的名称。</li>
</ul>
<h3 id="generics-Generics"><a href="#generics-Generics" class="headerlink" title="generics: Generics"></a><code>generics: Generics</code></h3><ul>
<li><code>generics</code> 字段表示函数的泛型参数。这包括泛型类型参数、生命周期参数以及它们的约束。</li>
<li>类型为 <code>Generics</code>，它包含了函数泛型参数的详细信息。</li>
</ul>
<h3 id="paren-token-Paren"><a href="#paren-token-Paren" class="headerlink" title="paren_token: Paren"></a><code>paren_token: Paren</code></h3><ul>
<li><code>paren_token</code> 字段是 <code>Paren</code> 类型的 token，表示函数参数列表周围的圆括号。</li>
</ul>
<h3 id="inputs-Punctuated"><a href="#inputs-Punctuated" class="headerlink" title="inputs: Punctuated&lt;FnArg, Comma&gt;"></a><code>inputs: Punctuated&lt;FnArg, Comma&gt;</code></h3><ul>
<li><code>inputs</code> 字段表示函数的输入参数列表。</li>
<li>类型为 <code>Punctuated&lt;FnArg, Comma&gt;</code>，这是一个使用逗号作为分隔符的列表，包含了一个或多个 <code>FnArg</code>（函数参数）。</li>
</ul>
<h3 id="variadic-Option"><a href="#variadic-Option" class="headerlink" title="variadic: Option&lt;Variadic&gt;"></a><code>variadic: Option&lt;Variadic&gt;</code></h3><ul>
<li><code>variadic</code> 字段表示函数是否接受可变数量的参数（即 C 风格的可变参数函数）。</li>
<li>类型为 <code>Option&lt;Variadic&gt;</code>，这意味着该字段可以是 <code>None</code>（表示函数不接受可变数量的参数）或 <code>Some(Variadic)</code>（表示函数接受可变数量的参数）。</li>
</ul>
<h3 id="output-ReturnType"><a href="#output-ReturnType" class="headerlink" title="output: ReturnType"></a><code>output: ReturnType</code></h3><ul>
<li><code>output</code> 字段表示函数的返回类型。</li>
<li>类型为 <code>ReturnType</code>，它可以是 <code>ReturnType::Default</code>（对应于没有明确指定返回类型的情况，等同于返回 <code>()</code>）或 <code>ReturnType::Type</code>（包含具体的返回类型）。</li>
</ul>
<p><code>Signature</code> 结构体提供了对 Rust 函数签名的全面描述，包括函数的名称、参数、返回类型以及其他与函数行为相关的关键字（如 <code>async</code>、<code>const</code>、<code>unsafe</code>）。通过操作这些字段，你可以解析、构造或修改函数签名的 AST。</p>
<p>C 转换为 Rust，使用 syn 库进行 Rust 代码构建，将下面 case C转换为Rust中涉及到的变量、函数声明、调用等操作的对应关系完整的解析，给我一个模板让我能按照模板来将 C 程序和 Rust 程序的对应关系呈现出来</p>
<h2 id="prompt"><a href="#prompt" class="headerlink" title="prompt"></a>prompt</h2><pre><code>你是 C Rust 语言领域资深专家，回答我的问题。我在做关于 C 转换为 Rust 的规则整理，其中计划使用 syn 库进行 Rust 代码构建，将下面 case 中 C转换为Rust中涉及到的变量、函数声明、调用等操作的对应关系完整的解析，并给出详细解析

模板
## **函数定义**:
### 返回值类型
   - **C**: 使用关键字 `void` 表示没有返回值的函数。
   - **Rust**: Rust 中没有返回值的函数隐式返回 `()`，通常省略返回类型。

### ...
   - ...
   - ...
   
## **传入参数**:
### 传入参数格式
   - **C**: 参数类型直接写在参数名前面。
   - **Rust**: 参数类型由冒号隔开，格式为 `param_name: type`。

### ...
   - ...
   - ...

## **循环控制**:
### for 循环写作格式
   - **C**: 使用 `for` 循环，初始化变量，条件和增量在括号内定义。
   - **Rust**: 使用 `for` 循环遍历一个范围，范围由 `start..end` 表示。
   
### ...
   - ...
   - ...
   
## **常用库**:
### 标准输入输出
   - **C**: 使用 `printf` 函数。
   - **Rust**: 使用 `println!` 宏。
   
### ...
   - ...
   - ...
   
## **主函数**:
### 主函数返回值规则
   - **C**: 主函数 `main` 返回 `int` 类型，表示程序退出状态。
   - **Rust**: 主函数 `main` 没有返回值，错误处理通常通过 `Result` 或 `panic!` 处理。

### ...
   - ...
   - ...
   
## ...
</code></pre>

    </div>
    
    
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2024 - 2024 Xiaoy
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;xiaoy
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    




    
</body>
</html>
