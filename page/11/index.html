
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Xiaoy</title>
    <meta name="author" content="xiaoy" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>





<script src="/js/lib/home.js"></script>

<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>XIAOY</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;XIAOY</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div id="home-head">
    <div
        id="home-background"
        ref="homeBackground"
        data-images="/images/background.jpg"
    ></div>
    <div id="home-info" @click="homeClick">
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="info">
            <div class="wrap">
                <h1>Xiaoy</h1>
                <h3>xiaoy blog</h3>
                <h5></h5>
            </div>
        </span>
    </div>
</div>
<div
    id="home-posts-wrap"
    ref="homePostsWrap"
    true
>
    <div id="home-posts">
        

<div class="post">
    <a href="/2024/04/29/mdstorage/domain/golang/gopackage/">
        <h2 class="post-title">gopackage.md</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/domain/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                domain
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/29
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>存放 golang 的 package 使用技巧</p>
<h2 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h2><h3 id="errgroup"><a href="#errgroup" class="headerlink" title="errgroup"></a>errgroup</h3><p>提供多个协程间同步机制，一个协程出错，其他协程可以被同步到这个错误</p>
<pre><code class="go">package main

import (
    &quot;context&quot;
    &quot;errors&quot;
    &quot;fmt&quot;
    &quot;golang.org/x/sync/errgroup&quot;
)

func main() &#123;
    g, ctx := errgroup.WithContext(context.Background())

    g.Go(func() error &#123;
        fmt.Println(&quot;Start executing task1&quot;)
        return nil
    &#125;)

    g.Go(func() error &#123;
        fmt.Println(&quot;Start executing task2&quot;)
        return errors.New(&quot;error happened in task2&quot;)
    &#125;)

    g.Go(func() error &#123;
        select &#123;
        case &lt;-ctx.Done():
            fmt.Println(&quot;task3 canceled&quot;)
            return ctx.Err()
        default:
            fmt.Println(&quot;Start executing task3&quot;)
            return nil
        &#125;
    &#125;)

    if err := g.Wait(); err != nil &#123;
        fmt.Println(&quot;Error happened: &quot;, err)
    &#125;
&#125;

//Start executing task1
//Start executing task2
//Start executing task3
//task3 canceled
//Error happened:  error happened in task2
</code></pre>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h2 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h2><h2 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h2>
            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/golang/" style="color: #ff7d73">golang</a>
        </span>
        
    </div>
    <a href="/2024/04/29/mdstorage/domain/golang/gopackage/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/04/25/mdstorage/my/">
        <h2 class="post-title">my.md</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/25
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h2 id="Linux-配置"><a href="#Linux-配置" class="headerlink" title="Linux 配置"></a>Linux 配置</h2><h3 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h3><h4 id="edge-安装"><a href="#edge-安装" class="headerlink" title="edge 安装"></a>edge 安装</h4><h4 id="firefox-安装"><a href="#firefox-安装" class="headerlink" title="firefox 安装"></a>firefox 安装</h4><h4 id="clash-安装"><a href="#clash-安装" class="headerlink" title="clash 安装"></a>clash 安装</h4><h4 id="dida-安装"><a href="#dida-安装" class="headerlink" title="dida 安装"></a>dida 安装</h4><h4 id="listen1-安装"><a href="#listen1-安装" class="headerlink" title="listen1 安装"></a>listen1 安装</h4><h4 id="snipaste-安装"><a href="#snipaste-安装" class="headerlink" title="snipaste 安装"></a>snipaste 安装</h4><h4 id="virt-manager-安装"><a href="#virt-manager-安装" class="headerlink" title="virt-manager 安装"></a>virt-manager 安装</h4><h4 id="fcitx5-安装"><a href="#fcitx5-安装" class="headerlink" title="fcitx5 安装"></a>fcitx5 安装</h4><h3 id="桌面美化"><a href="#桌面美化" class="headerlink" title="桌面美化"></a>桌面美化</h3><h3 id="定时脚本"><a href="#定时脚本" class="headerlink" title="定时脚本"></a>定时脚本</h3><h4 id="定时提交"><a href="#定时提交" class="headerlink" title="定时提交"></a>定时提交</h4><pre><code class="Text">0 2 * * * /opt/mystorage/github/dairy/script/commit_cron.sh
</code></pre>
<h2 id="快捷键配置"><a href="#快捷键配置" class="headerlink" title="快捷键配置"></a>快捷键配置</h2><h3 id="Jetbrains-keymap"><a href="#Jetbrains-keymap" class="headerlink" title="Jetbrains keymap"></a>Jetbrains keymap</h3><h4 id="keymap"><a href="#keymap" class="headerlink" title="keymap"></a>keymap</h4><ul>
<li>emacs </li>
<li>previous project window  : C-q</li>
<li>back                     : C-M-,</li>
<li>forward                  : C-M-.</li>
</ul>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/my/" style="color: #00bcd4">my</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/me/" style="color: #03a9f4">me</a>
        </span>
        
    </div>
    <a href="/2024/04/25/mdstorage/my/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/04/25/mdstorage/domain/linux/gnome%E6%A1%8C%E9%9D%A2%E7%BE%8E%E5%8C%96/">
        <h2 class="post-title">gnome桌面美化.md</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/domain/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                domain
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/25
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h2 id="任务栏美化"><a href="#任务栏美化" class="headerlink" title="任务栏美化"></a>任务栏美化</h2><p><a target="_blank" rel="noopener" href="https://extensions.gnome.org/extension/307/dash-to-dock/">dash to dock</a><br>注意要选择 gnome 版本，不然存在不兼容情况</p>
<p>搜索 扩展 应用，里面将 Dash to Dock 进行设置即可</p>
<pre><code>bash

sudo apt update
sudo apt install gnome-shell-extension-prefs
</code></pre>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/Linux/" style="color: #00bcd4">Linux</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/gnome/" style="color: #03a9f4">gnome</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/Ubuntu/" style="color: #ff7d73">Ubuntu</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/Debian/" style="color: #ffa2c4">Debian</a>
        </span>
        
    </div>
    <a href="/2024/04/25/mdstorage/domain/linux/gnome%E6%A1%8C%E9%9D%A2%E7%BE%8E%E5%8C%96/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/04/25/mdstorage/domain/python/python%E5%AE%89%E8%A3%85/">
        <h2 class="post-title">python</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/domain/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                domain
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/25
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>python3 Linux 安装</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>python3 安装</p>
<pre><code class="Bash">
#! /bin/bash
# debian安装python3

# openssl-devel libffi-devel gcc 如果不安装，将会导致后面出问题；其他的没试过
sudo apt-get install aptitude
sudo aptitude -y install gcc make zlib1g-dev libffi-dev libssl-dev

if [ ! -d &quot;/opt/software&quot; ]
  then
    mkdir -p /opt/software
fi

cd /opt/software

version=3.12.3
short_version=3.12

#wget https://www.python.org/ftp/python/$&#123;version&#125;/Python-$&#123;version&#125;.tar.xz
wget https://mirrors.aliyun.com/python-release/source/Python-$&#123;version&#125;.tar.xz
echo &quot;解压 ...&quot;
xz -d Python-$&#123;version&#125;.tar.xz
tar -xf Python-$&#123;version&#125;.tar
cd Python-$&#123;version&#125;

# 配置 ssl，不然pip install会出问题
sudo ./configure --prefix=/usr/local/python3 --with-ssl --enable-optimizations

# make altinstall将不会让python3替代原本的python2，不会使yum出问题
sudo make &amp;&amp; make altinstall
ln -s /usr/local/python3/bin/python$&#123;short_version&#125; /usr/bin/python3
ln -s /usr/local/python3/bin/pip$&#123;short_version&#125; /usr/bin/pip3

</code></pre>
<p>virtualenvwrapper 安装</p>
<pre><code class="Bash">#! /bin/bash

# 安装python3 的虚拟环境 virtualenvwrapper
echo &#39;install virtualenv tool ....&#39;
pip3 install virtualenv -i https://pypi.tuna.tsinghua.edu.cn/simple
pip3 install virtualenvwrapper -i https://pypi.tuna.tsinghua.edu.cn/simple

VM_HOME=~/py_vm

mkdir $&#123;VM_HOME&#125;

# 添加wrapper的配置
echo -e &quot;export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3\nexport WORKON_HOME=$&#123;VM_HOME&#125;\nexport VIRTUALENVWRAPPER_VIRTUALENV=~/.local/bin/virtualenv\nsource ~/.local/bin/virtualenvwrapper.sh&quot; &gt;&gt; ~/.bashrc
</code></pre>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/python/" style="color: #00a596">python</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/pip/" style="color: #00bcd4">pip</a>
        </span>
        
    </div>
    <a href="/2024/04/25/mdstorage/domain/python/python%E5%AE%89%E8%A3%85/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/04/24/mdstorage/domain/golang/delve/">
        <h2 class="post-title">delve.md</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/domain/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                domain
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/24
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Go 的调试工具</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre><code class="Bash">go install github.com/go-delve/delve/cmd/dlv@latest
</code></pre>
<h2 id="Goland-配合本地调试（本地-Ubuntu）"><a href="#Goland-配合本地调试（本地-Ubuntu）" class="headerlink" title="Goland 配合本地调试（本地 Ubuntu）"></a>Goland 配合本地调试（本地 Ubuntu）</h2><p>本地执行 <code>dlv debug --headless --listen=:2345 --api-version=2 --accept-multiclient $main_path</code></p>
<p>Goland Debug -&gt; Go remote </p>
<h2 id="Goland-配合远程调试"><a href="#Goland-配合远程调试" class="headerlink" title="Goland 配合远程调试"></a>Goland 配合远程调试</h2><p>dlv –headless –listen&#x3D;:2345 –api-version&#x3D;2 –log attach ${PID}  </p>
<p>开启 Goland 远程 debug，要填入远程机器地址</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/delve/" style="color: #00bcd4">delve</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/dlv/" style="color: #ff7d73">dlv</a>
        </span>
        
    </div>
    <a href="/2024/04/24/mdstorage/domain/golang/delve/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/04/22/mdstorage/domain/%E8%99%9A%E6%8B%9F%E5%8C%96/docker-compose/">
        <h2 class="post-title">docker-compose.md</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/domain/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                domain
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/22
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre><code class="bash">version=v2.26.1
sudo curl -L &quot;https://github.com/docker/compose/releases/download/$&#123;version&#125;/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
</code></pre>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/docker/" style="color: #ff7d73">docker</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/docker-compose/" style="color: #00a596">docker-compose</a>
        </span>
        
    </div>
    <a href="/2024/04/22/mdstorage/domain/%E8%99%9A%E6%8B%9F%E5%8C%96/docker-compose/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/04/22/mdstorage/project/sr/%E7%BB%84%E4%BB%B6/installer/">
        <h2 class="post-title">installer.md</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/22
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h2 id="设计目标"><a href="#设计目标" class="headerlink" title="设计目标"></a>设计目标</h2><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="容器测试"><a href="#容器测试" class="headerlink" title="容器测试"></a>容器测试</h3><h4 id="容器测试1"><a href="#容器测试1" class="headerlink" title="容器测试1"></a>容器测试1</h4><p>容器编译运行 installer-manager</p>
<pre><code class="bash"># mysql 依赖
docker run --name mysql  -e MYSQL_DATABASE=manager -e MYSQL_ROOT_PASSWORD=123.com/456 -p 127.0.0.1:3306:3306 -d mysql:5.7

docker build -t installer .

docker run --net=host -e SC_IP=127.0.0.1 -d -p 8098:8098 --name installer installer
# docker run --net=host -e SC_IP=172.18.0.3 -d -p 8098:8098 --name installer installer
</code></pre>
<h4 id="容器测试2"><a href="#容器测试2" class="headerlink" title="容器测试2"></a>容器测试2</h4><p>准备 se 机器</p>
<pre><code class="bash">docker build -f test/se/Dockerfile -t se .

docker run -d -p 22222:22222 --privileged --name se -v /sys/fs/cgroup:/sys/fs/cgroup:ro  -v /run/dbus/system_bus_socket:/run/dbus/system_bus_socket:ro -v /run/dbus:/run/dbus  --cap-add SYS_ADMIN se &amp;&amp; docker exec se /scripts/startup.sh
</code></pre>
<h4 id="容器测试3"><a href="#容器测试3" class="headerlink" title="容器测试3"></a>容器测试3</h4><p>docker compose 将 mysql installer-manager se 都启动，使 installer-manager 对执行测试用例</p>
<pre><code class="bash">docker build -t installer . &amp;&amp; docker-compose -f test/e2e/base.yml up -d

# 停止 docker-compose  -f test/e2e/base.yml down
</code></pre>
<h4 id="容器测试4"><a href="#容器测试4" class="headerlink" title="容器测试4"></a>容器测试4</h4><pre><code class="go">package sccore

import (
    &quot;context&quot;
    &quot;crypto/tls&quot;
    &quot;crypto/x509&quot;
    &quot;encoding/json&quot;
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;log&quot;
    &quot;strings&quot;
    &quot;sync&quot;
    &quot;testing&quot;
    &quot;time&quot;

    &quot;google.golang.org/grpc/credentials&quot;

    &quot;git.ouryun.cn/base/go-kit/pkg/ca&quot;
    mdv1 &quot;git.ouryun.cn/base/proto-store/pkg/api/common/metadata/v1&quot;
    &quot;git.ouryun.cn/base/proto-store/pkg/client&quot;
    proto_common &quot;git.ouryun.cn/base/proto-store/pkg/common&quot;
    &quot;git.ouryun.cn/base/proto-store/pkg/interfaces&quot;
    &quot;git.ouryun.cn/base/proto-store/pkg/options&quot;
    &quot;git.ouryun.cn/base/proto-store/pkg/proto_store&quot;
    &quot;git.ouryun.cn/base/proto-store/pkg/types&quot;
)

const (
    managerClientReconnectTimeout = time.Second * 3
    scCoreAddress                 = &quot;sc.srhino.svc.local&quot;
    scCorePort                    = 20111
)
const (
    ExecCommand = &quot;/v1/agent/cmd&quot;
    UploadFile  = &quot;/v1/agent/upload&quot;
)

var (
    managerClientInstance *managerClient
    mgntClientMu          = sync.Mutex&#123;&#125;
)

type ExitError struct &#123;
    code int

    // Stderr holds a subset of the standard error output from the
    // Cmd.Output method if standard error was not otherwise being
    // collected.
    //
    // If the error output is long, Stderr may contain only a prefix
    // and suffix of the output, with the middle replaced with
    // text about the number of omitted bytes.
    //
    // Stderr is provided for debugging, for inclusion in error messages.
    // Users with other needs should redirect Cmd.Stderr as needed.
    Stderr []byte
&#125;

func (e *ExitError) Error() string &#123;
    return fmt.Sprintf(&quot;exit with status %d, err info: %s&quot;, e.code, e.Stderr)
&#125;

type RPCError struct &#123;
    statusCode proto_common.StatusCode
    err        error
&#125;

func (e *RPCError) Error() string &#123;
    return fmt.Sprintf(&quot;rpc error %v, status:%v&quot;, e.err.Error(), e.statusCode)
&#125;

func (e *RPCError) Unwrap() error &#123;
    return e.err
&#125;

type managerClient struct &#123;
    interfaces.CoreClient
&#125;

type engineClient struct &#123;
    mu          sync.RWMutex
    cli         *managerClient
    config      *EngineClientConfig
    nodeClients map[string]*NodeClient
&#125;

type NodeClient struct &#123;
    engineCli *engineClient
    nodeId    string
&#125;

type EngineClientConfig struct &#123;
    SN string
    // zero is no timeout
    Timeout time.Duration
&#125;

type CmdRequest struct &#123;
    Name string   `json:&quot;name&quot;`
    Args []string `json:&quot;args&quot;`
&#125;

type CmdResponse struct &#123;
    ExitCode int    `json:&quot;exitCode&quot;`
    Stdout   string `json:&quot;stdout&quot;`
    Stderr   string `json:&quot;stderr&quot;`
&#125;

func (c *NodeClient) callExecCommand(name string, args ...string) (*CmdResponse, error) &#123;
    reqBody := &amp;CmdRequest&#123;
        Name: name,
        Args: args,
    &#125;

    code, bodyBytes, err := c.Post(ExecCommand, reqBody)
    if err != nil &#123;
        rpcerr := &amp;RPCError&#123;
            err: err,
        &#125;
        return nil, rpcerr
    &#125;

    if code == proto_common.StatusServiceUnavailable &#123;
        rpcerr := &amp;RPCError&#123;
            statusCode: code,
            err:        proto_common.ErrNotFoundClient,
        &#125;
        return nil, rpcerr
    &#125; else if code != proto_common.StatusOK &#123;
        rpcerr := &amp;RPCError&#123;
            statusCode: code,
        &#125;
        return nil, rpcerr
    &#125;

    resp := &amp;CmdResponse&#123;&#125;
    if err := json.Unmarshal(bodyBytes, resp); err != nil &#123;
        return nil, err
    &#125;

    return resp, nil
&#125;

func (c *NodeClient) Output(name string, args ...string) ([]byte, error) &#123;
    resp, err := c.callExecCommand(name, args...)
    if err != nil &#123;
        return nil, err
    &#125;

    if resp.ExitCode != 0 &#123;
        return nil, &amp;ExitError&#123;code: resp.ExitCode, Stderr: []byte(resp.Stderr)&#125;
    &#125;

    return []byte(resp.Stdout), nil
&#125;

func (c *NodeClient) CombinedOutput(name string, args ...string) ([]byte, error) &#123;
    resp, err := c.callExecCommand(name, args...)
    if err != nil &#123;
        return nil, err
    &#125;

    if resp.ExitCode != 0 &#123;
        return nil, &amp;ExitError&#123;code: resp.ExitCode, Stderr: []byte(resp.Stderr)&#125;
    &#125;

    return []byte(resp.Stdout + resp.Stderr), nil
&#125;

func (c *NodeClient) Upload(local io.Reader, remotePath string) error &#123;
    // 构造请求
    protoCtx := proto_store.NewRequestContext()
    dst := &amp;mdv1.Metadata_Info&#123;
        Engine:    &amp;mdv1.Engine&#123;SerialNumber: c.engineCli.config.SN&#125;,
        Component: types.COMPONENT_TAG_WEBSERVER,
        Node:      &amp;mdv1.Node&#123;Id: c.nodeId&#125;,
    &#125;

    req := protoCtx.SetUrl(UploadFile).SetDst(dst)
    req.SetParams(&quot;path&quot;, remotePath)
    req.SetFileReader(local)
    req.SetMethod(mdv1.Method_POST.String())
    resp, err := c.engineCli.cli.FileStream(req)
    if err != nil &#123;
        rpcerr := &amp;RPCError&#123;
            err: err,
        &#125;
        return rpcerr
    &#125;
    defer resp.Response().Body.Close()

    code := resp.Response().StatusCode
    if code == proto_common.StatusServiceUnavailable &#123;
        rpcerr := &amp;RPCError&#123;
            statusCode: code,
            err:        proto_common.ErrNotFoundClient,
        &#125;
        return rpcerr
    &#125; else if code != proto_common.StatusOK &#123;
        rpcerr := &amp;RPCError&#123;
            statusCode: code,
        &#125;
        return rpcerr
    &#125;

    return nil
&#125;

func (c *NodeClient) Close() error &#123;
    _ = c.engineCli.nodeClose(c.nodeId)
    c.engineCli = nil
    c.nodeId = &quot;&quot;
    return nil
&#125;

func (c *NodeClient) String() string &#123;
    return fmt.Sprintf(&quot;node cliet for engine:[%v], node:[%v]&quot;, c.engineCli.config.SN, c.nodeId)
&#125;

// Hello 用于检查节点的webserver服务是否可用
func (c *NodeClient) Hello() error &#123;
    outputBytes, err := c.Output(&quot;echo&quot;, &quot;hello&quot;)
    if err != nil &#123;
        return err
    &#125;
    output := strings.TrimSpace(string(outputBytes))
    if output != &quot;hello&quot; &#123;
        return fmt.Errorf(&quot;unexpect result&quot;)
    &#125;
    return nil
&#125;

func (c *NodeClient) Post(api string, body any) (proto_common.StatusCode, []byte, error) &#123;
    return c.engineCli.Post(c.nodeId, api, body)
&#125;
func (c *NodeClient) Get(api string) (proto_common.StatusCode, []byte, error) &#123;
    return c.engineCli.Get(c.nodeId, api)
&#125;

// @parm host 用于定位具体的节点，应该传递nodeUID
// @param api 由于这个参数仅包含api路径，不包含能用于定位对端服务的host，所以不起名为url
func (c *engineClient) Post(host string, api string, body any) (proto_common.StatusCode, []byte, error) &#123;
    // 构造请求
    protoCtx := proto_store.NewRequestContext()
    dst := &amp;mdv1.Metadata_Info&#123;
        Engine:    &amp;mdv1.Engine&#123;SerialNumber: c.config.SN&#125;,
        Component: types.COMPONENT_TAG_WEBSERVER,
    &#125;
    if host != &quot;&quot; &#123;
        dst.Node = &amp;mdv1.Node&#123;Id: host&#125;
    &#125;
    req := protoCtx.SetUrl(api).SetDst(dst)
    if c.config.Timeout != 0 &#123;
        req.SetTimeout(c.config.Timeout)
    &#125;
    // 设置body
    if body != nil &#123;
        if err := req.SetRequestBody(body); err != nil &#123;
            return 0, nil, err
        &#125;
    &#125;
    // 发送请求
    resp, err := c.cli.Post(req)
    if err != nil &#123;
        return 0, nil, err
    &#125;

    // 资源回收
    defer resp.Body.Close()

    // 读取响应
    respBody, err := io.ReadAll(resp.Body)
    if err != nil &#123;
        return 0, nil, err
    &#125;

    return resp.StatusCode, respBody, nil
&#125;

func (c *engineClient) Get(host string, api string) (proto_common.StatusCode, []byte, error) &#123;
    // 构造请求
    protoCtx := proto_store.NewRequestContext()
    dst := &amp;mdv1.Metadata_Info&#123;
        Engine:    &amp;mdv1.Engine&#123;SerialNumber: c.config.SN&#125;,
        Component: types.COMPONENT_TAG_WEBSERVER,
    &#125;
    if host != &quot;&quot; &#123;
        dst.Node = &amp;mdv1.Node&#123;Id: host&#125;
    &#125;
    req := protoCtx.SetUrl(api).SetDst(dst)
    if c.config.Timeout != 0 &#123;
        req.SetTimeout(c.config.Timeout)
    &#125;

    // 发送请求
    resp, err := c.cli.Get(req)
    if err != nil &#123;
        return 0, nil, err
    &#125;

    // 资源回收
    defer resp.Body.Close()

    // 读取响应
    respBody, err := io.ReadAll(resp.Body)
    if err != nil &#123;
        return 0, nil, err
    &#125;

    return resp.StatusCode, respBody, nil
&#125;

func (c *engineClient) NodeClient(id string) *NodeClient &#123;
    if id == &quot;&quot; &#123;
        panic(&quot;node id should not be empty&quot;)
    &#125;

    nodeCli, ok := c.nodeClients[id]
    if !ok &#123;
        nodeCli = &amp;NodeClient&#123;
            engineCli: c,
            nodeId:    id,
        &#125;
        c.nodeClients[id] = nodeCli
    &#125;

    return nodeCli
&#125;

func (c *engineClient) nodeClose(id string) error &#123;
    delete(c.nodeClients, id)
    return nil
&#125;

func (c *engineClient) Close() error &#123;
    c.mu.Lock()
    defer c.mu.Unlock()

    // 关闭node client
    keys := make([]string, 0, len(c.nodeClients))
    for k := range c.nodeClients &#123;
        keys = append(keys, k)
    &#125;

    for _, key := range keys &#123;
        _ = c.nodeClose(key)
    &#125;

    // 关闭连接
    // c.cli.Stop()

    return nil
&#125;

func newManagerClient(tlsConfig *tls.Config) *managerClient &#123;
    creds := credentials.NewTLS(tlsConfig)
    cli, err := client.NewClientService(context.Background(), options.ServiceOption&#123;
        Address:   scCoreAddress,
        Port:      scCorePort,
        Component: types.COMPONENT_TAG_UNKNOWN,
        Creds:     creds,
    &#125;)
    if err != nil &#123;
        panic(err)
    &#125;
    if err := cli.Connect(); err != nil &#123;
        // logger.Logger.Warnf(&quot;connect to sc-core failed:%v&quot;, err)
        return nil
    &#125;
    go func() &#123;
        for &#123;
            err := cli.Start()
            if err != nil &#123;
                // logger.Logger.Errorf(&quot;manager core client start failed:%v&quot;, err.Error())
            &#125;
            time.Sleep(managerClientReconnectTimeout)
            if err := cli.Connect(); err != nil &#123;
                // logger.Logger.Warnf(&quot;connect to sc-core failed:%v&quot;, err)
            &#125;
        &#125;
    &#125;()

    return &amp;managerClient&#123;CoreClient: cli&#125;
&#125;

func getManagerClient() *managerClient &#123;
    mgntClientMu.Lock()
    defer mgntClientMu.Unlock()
    if managerClientInstance == nil &#123;
        clientCert, err := tls.X509KeyPair(ca.Generate(&quot;Manager&quot;))
        if err != nil &#123;
            log.Fatalf(&quot;Failed to load client certificate: %v&quot;, err)
        &#125;
        caCert, _ := ca.RootCa()
        caCertPool := x509.NewCertPool()
        caCertPool.AppendCertsFromPEM(caCert)
        _ = clientCert
        clientTLSConfig := &amp;tls.Config&#123;
            // ServerName:   &quot;sc.srhino.svc.local&quot;,
            // Certificates: []tls.Certificate&#123;clientCert&#125;,
            // RootCAs:      caCertPool, // 信任服务端证书的根 CA
            InsecureSkipVerify: true,
        &#125;

        managerClientInstance = newManagerClient(clientTLSConfig)
    &#125;

    return managerClientInstance
&#125;

// 当manager与sc-core无法通信时才会返回错误
func NewEngineClient(config *EngineClientConfig) (*engineClient, error) &#123;
    cli := getManagerClient()
    if cli == nil &#123;
        return nil, fmt.Errorf(&quot;get manager client failed&quot;)
    &#125;

    return &amp;engineClient&#123;
        cli:         cli,
        config:      config,
        nodeClients: make(map[string]*NodeClient),
    &#125;, nil
&#125;

func TestEngineClient(t *testing.T) &#123;
    engineCli, err := NewEngineClient(&amp;EngineClientConfig&#123;SN: &quot;SN123&quot;&#125;)
    if err != nil &#123;
        t.Error(err)
    &#125;
    defer engineCli.Close()
    nodeCli := engineCli.NodeClient(&quot;69ea20be-8be2-4432-8c0a-288af1c9deae&quot;)
    if err := nodeCli.Hello(); err != nil &#123;
        t.Error(err)
    &#125;
&#125;
</code></pre>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/sr/" style="color: #00a596">sr</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/%E5%AE%89%E8%A3%85/" style="color: #03a9f4">安装</a>
        </span>
        
    </div>
    <a href="/2024/04/22/mdstorage/project/sr/%E7%BB%84%E4%BB%B6/installer/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/04/19/mdstorage/domain/search/github/">
        <h2 class="post-title">github.md</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/domain/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                domain
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/19
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>github Search 语法可用于搜索代码</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://docs.github.com/en/search-github/github-code-search/understanding-github-code-search-syntax">文档</a></p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ul>
<li>语法 option:param 之间没有空格</li>
</ul>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><h3 id="语言"><a href="#语言" class="headerlink" title="语言"></a>语言</h3><p><strong>单个</strong></p>
<pre><code class="text">language:Go OR language:Dockerfile
</code></pre>
<p><strong>多个</strong></p>
<pre><code class="text">language:ruby OR language:cpp OR language:csharp
</code></pre>
<h3 id="路径或文件名"><a href="#路径或文件名" class="headerlink" title="路径或文件名"></a>路径或文件名</h3><pre><code class="text">path:**/Dockerfile
path:*.txt
</code></pre>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/github/" style="color: #ffa2c4">github</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/code-search/" style="color: #03a9f4">code search</a>
        </span>
        
    </div>
    <a href="/2024/04/19/mdstorage/domain/search/github/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/04/19/mdstorage/project/sr/%E7%BB%84%E4%BB%B6/sc-core/">
        <h2 class="post-title">sc-core.md</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/19
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>sc-core 是 sc 的通信组件，提供：</p>
<ul>
<li>建立总控-引擎连接通道</li>
<li>通过通道发送信息</li>
</ul>
<p>的能力，它是一个 grpc server ，需要建立通道的组件都是 grpc client。</p>
<h2 id="设计目标"><a href="#设计目标" class="headerlink" title="设计目标"></a>设计目标</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul>
<li>部署问题：防火墙策略开放不合理；将之前 总控-&gt;引擎 这种开放策略改为 引擎-&gt;总控。原因详见通信链路相关机制讲解</li>
<li>链路繁杂问题：之前组件负责人各自进行开发，没有站在系统角度考虑问题，导致链路过多，通信混乱，增加了复杂度</li>
</ul>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><ul>
<li>使用 sc-core 作为通用通信组件，将防火墙策略问题解决了，即通信建立的方向为 引擎-&gt;总控。</li>
<li>客户端连接 sc-core 建立通信通道，将多条链路整合为了一条，降低了系统复杂度。</li>
</ul>
<h2 id="架构实现"><a href="#架构实现" class="headerlink" title="架构实现"></a>架构实现</h2><h3 id="主要原理"><a href="#主要原理" class="headerlink" title="主要原理"></a>主要原理</h3><ul>
<li>grpc 双向通信 （通道建立）</li>
<li>TLS （安全认证）</li>
<li>grpc streamInterceptor</li>
</ul>
<p><img src="/sc-core-arch.png" alt="img.png"></p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="基础库"><a href="#基础库" class="headerlink" title="基础库"></a>基础库</h4><h5 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h5><h6 id="core-message"><a href="#core-message" class="headerlink" title="core_message"></a>core_message</h6><p>core_message 是 sc-core 传输消息的协议</p>
<pre><code class="protobuf">// 元数据
message Metadata &#123;
  message Info &#123;
    // 引擎
    protobuf.common.v1.Engine engine = 1;
    // 节点
    protobuf.common.v1.Node node = 2;
    // 组件标识
    string component = 3;
  &#125;
  // 消息来源
  Info src = 1;
  // 消息目标
  Info dst = 2;
&#125;

message CoreMessage &#123;
  // 消息标识
  uint64 messageId = 1;

  Metadata metadata = 2;
  // 消息内容
  oneof message &#123;
    // 定义请求消息
    Request request = 4;
    // 定义响应消息
    Response response = 5;
  &#125;
  // 消息过期时间
  int64 expiredTime = 6;

  string version = 7;

  // 消息头
  map&lt;string, string&gt; headers = 9;

  // 消息序号
  uint64 Seq = 10;
&#125;
</code></pre>
<h6 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h6><pre><code class="protobuf">enum Method &#123;
  GET = 0;
  POST = 1;
  PUT = 2;
  DELETE = 3;
  PATCH = 4;
  LIST = 5;
&#125;

// 请求消息结构
message Request &#123;
  // 资源标识地址
  string url = 1;
  // 资源操作类型
  string method = 2;
  // 请求消息体
  bytes body = 3;
  // 请求参数
  map&lt;string, string&gt; params = 4;
&#125;
</code></pre>
<h6 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h6><pre><code class="protobuf">// 响应消息结构
message Response &#123;
  enum Code &#123;
    SUCCESS_CODE = 0;
    FAIL_CODE = 1;
  &#125;
  Code code = 1;
  bytes body = 2;
  string error = 3;
&#125;
</code></pre>
<h6 id="service-stream"><a href="#service-stream" class="headerlink" title="service stream"></a>service stream</h6><pre><code class="protobuf">service CoreService &#123;
  rpc Agent (stream protobuf.common.v1.CoreMessage) returns (stream protobuf.common.v1.CoreMessage)&#123;&#125;
&#125;
</code></pre>
<h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="容器测试"><a href="#容器测试" class="headerlink" title="容器测试"></a>容器测试</h3><h4 id="容器测试1"><a href="#容器测试1" class="headerlink" title="容器测试1"></a>容器测试1</h4><pre><code class="bash">docker build -t core .

docker run -d -p 20111:20111 --name core core
</code></pre>
<h4 id="容器测试2"><a href="#容器测试2" class="headerlink" title="容器测试2"></a>容器测试2</h4><p>Ubuntu20.04 安装</p>
<pre><code class="bash">docker build -f test/install/Dockerfile -t ubuntu-sc-core .

docker run -d -p 20111:20111 --privileged --name ubuntu-sc-core -v /sys/fs/cgroup:/sys/fs/cgroup:ro  -v /run/dbus/system_bus_socket:/run/dbus/system_bus_socket:ro -v /run/dbus:/run/dbus  --cap-add SYS_ADMIN ubuntu-sc-core &amp;&amp; docker exec ubuntu-sc-core systemctl start install.service
# 调试
# docker run -it -p 20111:20111 ubuntu-sc-core /bin/bash
</code></pre>
<h4 id="容器测试3"><a href="#容器测试3" class="headerlink" title="容器测试3"></a>容器测试3</h4><pre><code class="bash">docker build -f test/e2e/Dockerfile -t core-client .

# 本地测试
docker run --rm --net=host -e ADDR=127.0.0.1 -e LOOP=500 core-client

# 远程测试
docker run --rm -e ADDR=172.16.1.216 -e LOOP=500 core-client
</code></pre>
<h3 id="Makefile-执行-test"><a href="#Makefile-执行-test" class="headerlink" title="Makefile 执行 test"></a>Makefile 执行 test</h3><pre><code class="bash">make test-e2e
</code></pre>
<h2 id="异常梳理"><a href="#异常梳理" class="headerlink" title="异常梳理"></a>异常梳理</h2><h3 id="hosts-问题"><a href="#hosts-问题" class="headerlink" title="hosts 问题"></a>hosts 问题</h3><p>这个问题特征是sc core 找不到 客户端注册 信息，但是接收到 从客户端来的 request, 所以会返回给 客户端 503 找不到对端， 通过 ss 命令找到连到其他 sc ip 了<br>在 测试环境容易遇到，客户环境不太可能出现，遇到了可以立马查看 &#x2F;etc&#x2F;hosts，或者清理后重试</p>
<h3 id="对端问题"><a href="#对端问题" class="headerlink" title="对端问题"></a>对端问题</h3><p>对端退出</p>
<pre><code class="Text">2024/05/06 11:03:08 core client connection stop
2024/05/06 11:03:08 client handle recv ctx done
2024/05/06 11:03:08 rpc err:  rpc error: code = Canceled desc = grpc: the client connection is closing
2024/05/06 11:03:08 core client handle receive error rpc error: code = Canceled desc = grpc: the client connection is closing
2024/05/06 11:03:13 request: request timeout
panic: request timeout
</code></pre>
<h3 id="调试时出现"><a href="#调试时出现" class="headerlink" title="调试时出现"></a>调试时出现</h3><pre><code class="Text">2024/05/06 15:59:57 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 15:59:57 rpc err:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 15:59:57 core client handle receive error rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 15:59:57 start client server err: rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 15:59:57 core client connection close error: rpc error: code = Canceled desc = grpc: the client connection is closing
2024/05/06 15:59:57 core client connection stop
2024/05/06 15:59:58 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 15:59:58 rpc err:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 15:59:58 request: connect interrupted
2024/05/06 15:59:58 core client handle receive error rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 15:59:58 start err:  rpc error: code = Unavailable desc = error reading from server: EOF
panic: start client server err: rpc error: code = Unavailable desc = error reading from server: EOF



2024/05/06 16:27:29 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 rpc err:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 rpc err:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 request: message send fail:[EOF]
2024/05/06 16:27:30 core client handle receive error rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 start err:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 core client handle receive error rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 start client server err: rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:30 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:27:33 message send fail:[EOF]
2024/05/06 16:27:35 request chan delete user/info
2024/05/06 16:27:35 request: message send fail:[EOF]
2024/05/06 16:27:37 connect err:  context deadline exceeded
2024/05/06 16:27:37 message send fail:[EOF]
panic: context deadline exceeded



2024/05/06 16:23:32 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:23:32 rpc err:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:23:32 core client handle receive error rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:23:32 start err:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:23:32 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:23:32 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:23:32 rpc err:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:23:32 core client handle receive error rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:23:32 start err:  rpc error: code = Unavailable desc = error reading from server: EOF
2024/05/06 16:23:33 server is currently unavailable:  rpc error: code = Unavailable desc = error reading from server: EOF
panic: rpc error: code = Unavailable desc = error reading from server: EOF
</code></pre>
<h3 id="未知问题"><a href="#未知问题" class="headerlink" title="未知问题"></a>未知问题</h3><pre><code class="Text">rpc error: code = Unavailable desc = error reading from server: EOF
</code></pre>
<pre><code class="Text">dlv --listen=:2345 --headless=true --api-version=2 --accept-multiclient exec ./client dlv --listen=:2345 --headless=true --api-version=2 --accept-multiclient exec ./client -case base.simple -addr 127.0.0.1 -loop 100
</code></pre>
<pre><code class="Text"># 调试构建
go build -gcflags &quot;all=-N -l&quot; -o client cmd/client/main.go


# 调试运行
dlv --listen=:2345 --headless=true --api-version=2 --accept-multiclient exec ./client -- -case base.simple -addr 127.0.0.1 -loop 100
</code></pre>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/sr/" style="color: #ff7d73">sr</a>
        </span>
        
    </div>
    <a href="/2024/04/19/mdstorage/project/sr/%E7%BB%84%E4%BB%B6/sc-core/" class="go-post">阅读全文</a>
</div>

<div class="post">
    <a href="/2024/04/18/mdstorage/domain/linux/find/">
        <h2 class="post-title">find.md</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/domain/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                domain
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/4/18
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="find-概述"><a href="#find-概述" class="headerlink" title="find 概述"></a>find 概述</h2><p>linux 下查找文件的工具</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="根据日期查找文件"><a href="#根据日期查找文件" class="headerlink" title="根据日期查找文件"></a>根据日期查找文件</h3><pre><code class="bash"># 找到 /usr/lib/x86_64-linux-gnu/ 下 昨天到现在 这段时间被
find /usr/lib/x86_64-linux-gnu/ -type f -newermt &quot;yesterday&quot; -ls

# 找到 当前目录下, 创建时间为今天的文件, 只为当前目录
find . -maxdepth 1 -type f -newermt $(date +%Y-%m-%d) 
</code></pre>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/linux/" style="color: #00bcd4">linux</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/find/" style="color: #00a596">find</a>
        </span>
        
    </div>
    <a href="/2024/04/18/mdstorage/domain/linux/find/" class="go-post">阅读全文</a>
</div>


        <div class="page-current">
    
    <a class="page-num" href="/page/10/">
        <i class="fa-solid fa-caret-left fa-fw"></i>
    </a>
    <a class="page-num" href="/">1</a>
    <span class="page-omit">...</span>
    
    <span class="current">11</span>
    
    <a class="page-num" href="/page/12">
        12
    </a>
    
    
    <a class="page-num" href="/page/13">
        13
    </a>
    
    
    <span class="page-omit">...</span>
    <a class="page-num" href="/page/28">28</a>
    
    
    <a class="page-num" href="/page/12/">
        <i class="fa-solid fa-caret-right fa-fw"></i>
    </a>
    
</div>

    </div>
    
    <div id="home-card">
        <div id="card-style">
    <div id="card-div">
        <div class="avatar">
            <img src="/images/avatar.jpg" alt="avatar" />
        </div>
        <div class="name">xiaoy</div>
        <div class="description">
            <p>xiaoy<br>…</p>

        </div>
        
        
        <div class="friend-links">
            
            <div class="friend-link">
                <a href="https://abrance.github.io">Argvchs</a>
            </div>
            
        </div>
        
    </div>
</div>

    </div>
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2024 - 2024 Xiaoy
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;xiaoy
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
</body>
</html>
